â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                   â•‘
â•‘     ENVIRONMENT VARIABLES SETUP CHECKLIST                        â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

YOUR SITUATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ You have: DATABASE_URL (PostgreSQL configured)
âœ“ You have: POSTGRES_URL and related vars
âœ— Missing: OPENAI_API_KEY (needed for embeddings)
? Optional: BLOB_READ_WRITE_TOKEN (for Blob storage)


WHAT EACH VARIABLE DOES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

OPENAI_API_KEY âš ï¸ CRITICAL
  â€¢ Purpose: Compute embeddings from text
  â€¢ Cost: $0.02 per 1,000 examples (very cheap!)
  â€¢ Without it: Can't compute embeddings, API fails
  â€¢ Get from: https://platform.openai.com/account/api-keys
  
BLOB_READ_WRITE_TOKEN ğŸš€ OPTIONAL (RECOMMENDED)
  â€¢ Purpose: Store embeddings in Blob (faster than DB)
  â€¢ Cost: Free (100 GB included)
  â€¢ Without it: Falls back to database (still works)
  â€¢ Get from: Vercel Dashboard â†’ Storage â†’ Blob


STEP-BY-STEP SETUP:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 1: Get OPENAI_API_KEY
  1. Go to: https://platform.openai.com/account/api-keys
  2. Login with your OpenAI account
  3. Click: "Create new secret key"
  4. Copy the key (starts with "sk-proj-")
  âœ“ Done!

STEP 2: Add to Local Environment (.env.local)
  1. Open: .env.local in your project root
  2. Go to the END of the file
  3. Add a new line:
     
     OPENAI_API_KEY=sk-proj-your-actual-key-here
     
  4. Save the file
  âœ“ Done!

STEP 3: Test Locally
  1. Run: npm run dev
  2. Should NOT show "OPENAI_API_KEY is not set" errors
  3. Try: curl -X POST http://localhost:3000/api/recompute
  âœ“ Should work!

STEP 4: Add to Vercel
  1. Go to: https://vercel.com/dashboard
  2. Select your project: "intent-classifire"
  3. Click: Settings tab
  4. Click: Environment Variables (in sidebar)
  5. Click: "Add new"
  
  Add OPENAI_API_KEY:
    Name: OPENAI_API_KEY
    Value: sk-proj-your-actual-key-here
    Environment: âœ“ Production âœ“ Preview âœ“ Development
    Click: "Add"
  
  (Optional) Add BLOB_READ_WRITE_TOKEN:
    Name: BLOB_READ_WRITE_TOKEN
    Value: vercel_blob_rw_... (get from Vercel Blob storage)
    Environment: âœ“ Production âœ“ Preview âœ“ Development
    Click: "Add"
  âœ“ Done!

STEP 5: Redeploy to Vercel
  Option A: Via Git
    git add .env.local
    git commit -m "Add OPENAI_API_KEY"
    git push origin main
  
  Option B: Via Vercel Dashboard
    Go to: Deployments tab
    Find latest deployment
    Click: ... (three dots)
    Click: Redeploy
  âœ“ Done!

STEP 6: Test on Vercel
  1. Wait for deployment to complete
  2. Add example: POST /api/categories/4/examples
  3. Recompute: POST /api/recompute
  4. Check logs: Should see no API key errors
  5. Classify: POST /api/classify
  6. Should match category (not GPT fallback)
  âœ“ Success!


YOUR CHECKLIST:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

LOCAL SETUP:
  [ ] Got OPENAI_API_KEY from OpenAI
  [ ] Added OPENAI_API_KEY to .env.local
  [ ] Tested: npm run dev works
  [ ] Tested: /api/recompute endpoint
  [ ] No "OPENAI_API_KEY is not set" errors

VERCEL SETUP:
  [ ] Added OPENAI_API_KEY to Vercel env vars
  [ ] (Optional) Added BLOB_READ_WRITE_TOKEN
  [ ] Redeploy triggered
  [ ] Latest deployment shows "âœ“ Built successfully"

FINAL TEST:
  [ ] Add example to category
  [ ] Run recompute endpoint
  [ ] Classify with same prompt
  [ ] Check result:
      âœ“ Shows category (NOT GPT fallback)
      âœ“ Shows similarity score > 0.8


WHAT IF SOMETHING GOES WRONG?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Error: "OPENAI_API_KEY is not set"
â†’ Add it to .env.local AND Vercel env vars
â†’ Restart dev server (npm run dev)
â†’ Redeploy to Vercel

Error: "Invalid API key"
â†’ Get fresh key from OpenAI (old one may have expired)
â†’ Update in .env.local and Vercel
â†’ Redeploy

Error: "No such file or directory" (local save failed)
â†’ This is OK on Vercel without BLOB_READ_WRITE_TOKEN
â†’ Embeddings are stored in database (still works)
â†’ Add BLOB_READ_WRITE_TOKEN to Vercel for better performance

Still getting GPT fallback after recompute:
â†’ Check logs for: "[Recompute] âœ… Embeddings refreshed"
â†’ If NOT seen, run recompute again
â†’ Wait 5 seconds, then try classify again

Classification slow (3-5 seconds)?
â†’ Add BLOB_READ_WRITE_TOKEN to Vercel
â†’ Blob caching is 10x faster than DB queries


NEED HELP?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Read: ENV_SETUP_GUIDE.md (detailed instructions)
2. Read: FIX_COMPLETE_SUMMARY.md (what was fixed)
3. Check: Vercel logs for error messages
4. Check: Local logs (npm run dev terminal)


KEY NUMBERS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
OpenAI Cost: $0.00013 per 1,000 tokens (~$0.02 per 1,000 examples)
Free Monthly: $5 credit (covers ~250,000 embeddings!)
Computation Time: 30-60 seconds for recompute
Classification Speed: 1-2 seconds (with embeddings)
Cache Duration: 30 minutes


SUMMARY:
â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Code fixes complete (storage, caching, reload)
âœ“ Build passes successfully
â³ Waiting for: OPENAI_API_KEY setup
â³ Waiting for: Vercel deployment with env vars

Once you add OPENAI_API_KEY:
  â€¢ Recompute will work âœ“
  â€¢ Cache will refresh âœ“
  â€¢ Classifications will match âœ“
  â€¢ No more GPT fallbacks âœ“

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
